<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouthCare - Youth Mental Health Support</title>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* Your existing CSS remains exactly the same */
        :root {
            --primary: #FF7F50;
            --secondary: #FF9E7D;
            --accent: #FF6347;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --text: #333333;
            --light-gray: #e9ecef;
            --garden-green: #4CAF50;
            --time-blue: #2196F3;
            --weather-yellow: #FFC107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f5f7fa;
            color: var(--text);
            line-height: 1.6;
            font-family: 'Open Sans', sans-serif;
        }

        /* ... ALL YOUR EXISTING CSS STYLES REMAIN EXACTLY THE SAME ... */
        
        /* Add these new styles for forum functionality */
        .forum-category {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid var(--light-gray);
        }

        .forum-posts {
            margin-top: 20px;
        }

        .forum-post {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .post-author {
            font-weight: 600;
            color: var(--primary);
        }

        .post-date {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .post-content {
            margin-bottom: 10px;
        }

        .post-actions {
            display: flex;
            gap: 15px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s;
        }

        .post-action:hover {
            color: var(--primary);
        }

        .new-post-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .comments-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
        }

        .comment {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid var(--secondary);
        }

        .comment-form {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <!-- Your existing HTML structure remains exactly the same -->
    <header>
        <div class="container">
            <nav class="navbar">
                <div class="logo">
                    <div class="logo-icon">YC</div>
                    <h1>YouthCare</h1>
                </div>
                <ul class="nav-links">
                    <li><a href="#" data-page="home">Home</a></li>
                    <li><a href="#features" data-page="home">Features</a></li>
                    <li><a href="#new-features" data-page="home">New Tools</a></li>
                    <li><a href="#community" data-page="home">Community</a></li>
                    <li><a href="#" data-page="forum">Forum</a></li>
                    <li><a href="#" data-page="volunteer">Volunteer</a></li>
                </ul>
                <div class="auth-buttons">
                    <button class="btn btn-secondary" id="loginBtn">Login</button>
                    <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Your existing pages remain the same -->
    <div id="home-page" class="page active">
        <!-- ... your existing home page content ... -->
    </div>

    <!-- Updated Forum Page with Working Categories -->
    <div id="forum-page" class="page">
        <div class="container">
            <button class="btn btn-secondary back-button" data-page="home">‚Üê Back to Home</button>
            <div class="page-header">
                <h2>Community Forum</h2>
                <p>Connect with others, share experiences, and find support in our anonymous community</p>
            </div>
            <div class="page-content">
                <h3>Forum Categories</h3>
                
                <!-- General Discussion Category -->
                <div class="forum-category" id="general-discussion">
                    <div class="category-header">
                        <h3>General Discussion</h3>
                        <p>Share your thoughts, ask questions, and connect with others in a safe space.</p>
                        <button class="btn btn-primary" id="enter-general-discussion">Enter Discussion</button>
                    </div>
                    <div class="forum-posts" id="general-posts" style="display: none;">
                        <h4>Recent Posts</h4>
                        <div id="general-posts-list">
                            <!-- Posts will be loaded here -->
                        </div>
                        <div class="new-post-form" id="general-post-form" style="display: none;">
                            <h4>Create New Post</h4>
                            <div class="form-group">
                                <label for="general-post-title">Title</label>
                                <input type="text" id="general-post-title" class="form-control" placeholder="Enter post title">
                            </div>
                            <div class="form-group">
                                <label for="general-post-content">Content</label>
                                <textarea id="general-post-content" class="form-control" placeholder="Share your thoughts..." rows="4"></textarea>
                            </div>
                            <button class="btn btn-primary" id="submit-general-post">Submit Post</button>
                            <button class="btn btn-secondary" id="cancel-general-post">Cancel</button>
                        </div>
                        <button class="btn btn-primary" id="new-general-post" style="margin-top: 15px;">+ New Post</button>
                    </div>
                </div>

                <!-- Success Stories Category -->
                <div class="forum-category" id="success-stories">
                    <div class="category-header">
                        <h3>Success Stories</h3>
                        <p>Read and share stories of overcoming challenges and finding hope.</p>
                        <button class="btn btn-primary" id="enter-success-stories">Read Stories</button>
                    </div>
                    <div class="forum-posts" id="success-posts" style="display: none;">
                        <h4>Recent Stories</h4>
                        <div id="success-posts-list">
                            <!-- Stories will be loaded here -->
                        </div>
                        <div class="new-post-form" id="success-post-form" style="display: none;">
                            <h4>Share Your Success Story</h4>
                            <div class="form-group">
                                <label for="success-post-title">Title</label>
                                <input type="text" id="success-post-title" class="form-control" placeholder="Enter story title">
                            </div>
                            <div class="form-group">
                                <label for="success-post-content">Your Story</label>
                                <textarea id="success-post-content" class="form-control" placeholder="Share your success story..." rows="6"></textarea>
                            </div>
                            <button class="btn btn-primary" id="submit-success-post">Share Story</button>
                            <button class="btn btn-secondary" id="cancel-success-post">Cancel</button>
                        </div>
                        <button class="btn btn-primary" id="new-success-post" style="margin-top: 15px;">+ Share Your Story</button>
                    </div>
                </div>

                <!-- Coping Strategies Category -->
                <div class="forum-category" id="coping-strategies">
                    <div class="category-header">
                        <h3>Coping Strategies</h3>
                        <p>Discover and share techniques that help during difficult times.</p>
                        <button class="btn btn-primary" id="enter-coping-strategies">Explore Strategies</button>
                    </div>
                    <div class="forum-posts" id="coping-posts" style="display: none;">
                        <h4>Shared Strategies</h4>
                        <div id="coping-posts-list">
                            <!-- Strategies will be loaded here -->
                        </div>
                        <div class="new-post-form" id="coping-post-form" style="display: none;">
                            <h4>Share a Coping Strategy</h4>
                            <div class="form-group">
                                <label for="coping-post-title">Strategy Name</label>
                                <input type="text" id="coping-post-title" class="form-control" placeholder="Enter strategy name">
                            </div>
                            <div class="form-group">
                                <label for="coping-post-content">How It Helps</label>
                                <textarea id="coping-post-content" class="form-control" placeholder="Describe the strategy and how it helps..." rows="5"></textarea>
                            </div>
                            <button class="btn btn-primary" id="submit-coping-post">Share Strategy</button>
                            <button class="btn btn-secondary" id="cancel-coping-post">Cancel</button>
                        </div>
                        <button class="btn btn-primary" id="new-coping-post" style="margin-top: 15px;">+ Share Strategy</button>
                    </div>
                </div>

                <!-- Resources & Tips Category -->
                <div class="forum-category" id="resources-tips">
                    <div class="category-header">
                        <h3>Resources & Tips</h3>
                        <p>Find helpful resources and tips for mental wellness.</p>
                        <button class="btn btn-primary" id="enter-resources-tips">View Resources</button>
                    </div>
                    <div class="forum-posts" id="resources-posts" style="display: none;">
                        <h4>Community Resources</h4>
                        <div id="resources-posts-list">
                            <!-- Resources will be loaded here -->
                        </div>
                        <div class="new-post-form" id="resources-post-form" style="display: none;">
                            <h4>Share a Resource or Tip</h4>
                            <div class="form-group">
                                <label for="resources-post-title">Resource Title</label>
                                <input type="text" id="resources-post-title" class="form-control" placeholder="Enter resource title">
                            </div>
                            <div class="form-group">
                                <label for="resources-post-content">Description</label>
                                <textarea id="resources-post-content" class="form-control" placeholder="Describe the resource or tip..." rows="4"></textarea>
                            </div>
                            <button class="btn btn-primary" id="submit-resources-post">Share Resource</button>
                            <button class="btn btn-secondary" id="cancel-resources-post">Cancel</button>
                        </div>
                        <button class="btn btn-primary" id="new-resources-post" style="margin-top: 15px;">+ Share Resource</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Your other pages remain the same -->
    <div id="ai-assistant-page" class="page">
        <!-- ... your existing AI assistant page ... -->
    </div>

    <div id="volunteer-page" class="page">
        <!-- ... your existing volunteer page ... -->
    </div>

    <footer>
        <!-- ... your existing footer ... -->
    </footer>

    <!-- Your existing modals remain the same -->
    <div class="modal" id="loginModal">
        <!-- ... your existing login modal ... -->
    </div>

    <div class="modal" id="signupModal">
        <!-- ... your existing signup modal ... -->
    </div>

    <script>
        // Firebase Configuration with YOUR PROJECT ID
        const firebaseConfig = {
            apiKey: "AIzaSyC-6o3v6Q6p8Q6p8Q6p8Q6p8Q6p8Q6p8Q6p8",
            authDomain: "youthcarementalhealthtevizja.firebaseapp.com",
            projectId: "youthcarementalhealthtevizja",
            storageBucket: "youthcarementalhealthtevizja.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Database structure for Firestore
        const Database = {
            // User management
            async registerUser(userData) {
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        userData.email, 
                        userData.password
                    );
                    
                    // Add user data to Firestore
                    await db.collection('users').doc(userCredential.user.uid).set({
                        username: userData.username,
                        email: userData.email,
                        age: userData.age,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        role: 'user'
                    });
                    
                    return { success: true, user: userCredential.user };
                } catch (error) {
                    console.error("Registration error:", error);
                    return { success: false, error: error.message };
                }
            },

            async loginUser(email, password) {
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    return { success: true, user: userCredential.user };
                } catch (error) {
                    console.error("Login error:", error);
                    return { success: false, error: error.message };
                }
            },

            // Forum posts management
            async getPosts(category) {
                try {
                    const snapshot = await db.collection('forumPosts')
                        .where('category', '==', category)
                        .orderBy('createdAt', 'desc')
                        .limit(20)
                        .get();
                    
                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error("Error fetching posts:", error);
                    return [];
                }
            },

            async createPost(postData) {
                try {
                    const user = auth.currentUser;
                    if (!user) throw new Error("User not authenticated");

                    const post = {
                        title: postData.title,
                        content: postData.content,
                        category: postData.category,
                        authorId: user.uid,
                        authorName: postData.authorName || 'Anonymous',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        likes: 0,
                        comments: []
                    };

                    const docRef = await db.collection('forumPosts').add(post);
                    return { success: true, postId: docRef.id };
                } catch (error) {
                    console.error("Error creating post:", error);
                    return { success: false, error: error.message };
                }
            },

            async addComment(postId, commentData) {
                try {
                    const user = auth.currentUser;
                    if (!user) throw new Error("User not authenticated");

                    const comment = {
                        content: commentData.content,
                        authorId: user.uid,
                        authorName: commentData.authorName || 'Anonymous',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection('forumPosts').doc(postId).update({
                        comments: firebase.firestore.FieldValue.arrayUnion(comment)
                    });

                    return { success: true };
                } catch (error) {
                    console.error("Error adding comment:", error);
                    return { success: false, error: error.message };
                }
            },

            // Volunteer applications
            async submitVolunteerApplication(applicationData) {
                try {
                    const user = auth.currentUser;
                    const application = {
                        ...applicationData,
                        userId: user ? user.uid : null,
                        status: 'pending',
                        submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection('volunteerApplications').add(application);
                    return { success: true };
                } catch (error) {
                    console.error("Error submitting application:", error);
                    return { success: false, error: error.message };
                }
            },

            // User data management
            async getUserData(userId) {
                try {
                    const doc = await db.collection('users').doc(userId).get();
                    return doc.exists ? doc.data() : null;
                } catch (error) {
                    console.error("Error fetching user data:", error);
                    return null;
                }
            }
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Setup Firebase auth state listener
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    document.querySelector('.auth-buttons').innerHTML = `
                        <span style="color: var(--primary); margin-right: 15px;">Welcome!</span>
                        <button class="btn btn-outline" id="logoutBtn">Logout</button>
                    `;
                    document.getElementById('logoutBtn').addEventListener('click', logout);
                } else {
                    // User is signed out
                    document.querySelector('.auth-buttons').innerHTML = `
                        <button class="btn btn-secondary" id="loginBtn">Login</button>
                        <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                    `;
                    // Reattach event listeners
                    document.getElementById('loginBtn').addEventListener('click', () => openModal(loginModal));
                    document.getElementById('signupBtn').addEventListener('click', () => openModal(signupModal));
                }
            });

            // Load sample data
            loadSampleData();
            
            // Initialize all event listeners
            setupEventListeners();
            
            // Initialize features
            initializeFeatures();
            
            console.log('YouthCare app initialized with Firebase!');
        }

        // Forum functionality
        function setupForumEventListeners() {
            // General Discussion
            document.getElementById('enter-general-discussion').addEventListener('click', () => {
                toggleForumCategory('general');
                loadForumPosts('general');
            });
            document.getElementById('new-general-post').addEventListener('click', () => {
                showPostForm('general');
            });
            document.getElementById('submit-general-post').addEventListener('click', () => {
                submitPost('general');
            });
            document.getElementById('cancel-general-post').addEventListener('click', () => {
                hidePostForm('general');
            });

            // Success Stories
            document.getElementById('enter-success-stories').addEventListener('click', () => {
                toggleForumCategory('success');
                loadForumPosts('success');
            });
            document.getElementById('new-success-post').addEventListener('click', () => {
                showPostForm('success');
            });
            document.getElementById('submit-success-post').addEventListener('click', () => {
                submitPost('success');
            });
            document.getElementById('cancel-success-post').addEventListener('click', () => {
                hidePostForm('success');
            });

            // Coping Strategies
            document.getElementById('enter-coping-strategies').addEventListener('click', () => {
                toggleForumCategory('coping');
                loadForumPosts('coping');
            });
            document.getElementById('new-coping-post').addEventListener('click', () => {
                showPostForm('coping');
            });
            document.getElementById('submit-coping-post').addEventListener('click', () => {
                submitPost('coping');
            });
            document.getElementById('cancel-coping-post').addEventListener('click', () => {
                hidePostForm('coping');
            });

            // Resources & Tips
            document.getElementById('enter-resources-tips').addEventListener('click', () => {
                toggleForumCategory('resources');
                loadForumPosts('resources');
            });
            document.getElementById('new-resources-post').addEventListener('click', () => {
                showPostForm('resources');
            });
            document.getElementById('submit-resources-post').addEventListener('click', () => {
                submitPost('resources');
            });
            document.getElementById('cancel-resources-post').addEventListener('click', () => {
                hidePostForm('resources');
            });
        }

        function toggleForumCategory(category) {
            // Hide all forum posts
            document.querySelectorAll('.forum-posts').forEach(el => {
                el.style.display = 'none';
            });
            
            // Show selected category posts
            const postsElement = document.getElementById(`${category}-posts`);
            if (postsElement.style.display === 'none') {
                postsElement.style.display = 'block';
            } else {
                postsElement.style.display = 'none';
            }
        }

        async function loadForumPosts(category) {
            const posts = await Database.getPosts(category);
            const postsList = document.getElementById(`${category}-posts-list`);
            
            if (posts.length === 0) {
                postsList.innerHTML = '<p>No posts yet. Be the first to share!</p>';
                return;
            }
            
            postsList.innerHTML = '';
            posts.forEach(post => {
                const postElement = createPostElement(post, category);
                postsList.appendChild(postElement);
            });
        }

        function createPostElement(post, category) {
            const postElement = document.createElement('div');
            postElement.className = 'forum-post';
            postElement.innerHTML = `
                <div class="post-header">
                    <div class="post-author">${post.authorName}</div>
                    <div class="post-date">${new Date(post.createdAt?.toDate()).toLocaleDateString()}</div>
                </div>
                <div class="post-content">
                    <h5>${post.title}</h5>
                    <p>${post.content}</p>
                </div>
                <div class="post-actions">
                    <div class="post-action" onclick="likePost('${post.id}')">
                        <span>üëç</span>
                        <span>${post.likes || 0}</span>
                    </div>
                    <div class="post-action" onclick="toggleComments('${post.id}')">
                        <span>üí¨</span>
                        <span>${post.comments ? post.comments.length : 0}</span>
                    </div>
                </div>
                <div class="comments-section" id="comments-${post.id}" style="display: none;">
                    <div class="comments-list" id="comments-list-${post.id}">
                        ${post.comments ? post.comments.map(comment => `
                            <div class="comment">
                                <strong>${comment.authorName}:</strong> ${comment.content}
                                <small>${new Date(comment.createdAt?.toDate()).toLocaleDateString()}</small>
                            </div>
                        `).join('') : ''}
                    </div>
                    <div class="comment-form">
                        <textarea id="comment-${post.id}" class="form-control" placeholder="Add a comment..." rows="2"></textarea>
                        <button class="btn btn-primary" onclick="addComment('${post.id}')" style="margin-top: 10px;">Add Comment</button>
                    </div>
                </div>
            `;
            return postElement;
        }

        function showPostForm(category) {
            document.getElementById(`${category}-post-form`).style.display = 'block';
            document.getElementById(`new-${category}-post`).style.display = 'none';
        }

        function hidePostForm(category) {
            document.getElementById(`${category}-post-form`).style.display = 'none';
            document.getElementById(`new-${category}-post`).style.display = 'block';
            // Clear form
            document.getElementById(`${category}-post-title`).value = '';
            document.getElementById(`${category}-post-content`).value = '';
        }

        async function submitPost(category) {
            const title = document.getElementById(`${category}-post-title`).value;
            const content = document.getElementById(`${category}-post-content`).value;
            
            if (!title || !content) {
                showNotification('Please fill in both title and content', 'error');
                return;
            }
            
            const categoryMap = {
                'general': 'General Discussion',
                'success': 'Success Stories',
                'coping': 'Coping Strategies',
                'resources': 'Resources & Tips'
            };
            
            const result = await Database.createPost({
                title,
                content,
                category: categoryMap[category],
                authorName: 'Anonymous' // In real app, get from user profile
            });
            
            if (result.success) {
                showNotification('Post submitted successfully!', 'success');
                hidePostForm(category);
                loadForumPosts(category); // Refresh posts
            } else {
                showNotification('Error submitting post: ' + result.error, 'error');
            }
        }

        async function likePost(postId) {
            // Implement like functionality
            showNotification('Like functionality would be implemented here', 'info');
        }

        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            if (commentsSection.style.display === 'none') {
                commentsSection.style.display = 'block';
            } else {
                commentsSection.style.display = 'none';
            }
        }

        async function addComment(postId) {
            const commentContent = document.getElementById(`comment-${postId}`).value;
            
            if (!commentContent) {
                showNotification('Please write a comment', 'error');
                return;
            }
            
            const result = await Database.addComment(postId, {
                content: commentContent,
                authorName: 'Anonymous'
            });
            
            if (result.success) {
                showNotification('Comment added!', 'success');
                document.getElementById(`comment-${postId}`).value = '';
                // Refresh the posts to show new comment
                // In a real app, you might want to update just the comments for this post
            } else {
                showNotification('Error adding comment: ' + result.error, 'error');
            }
        }

        // Updated setupEventListeners to include forum
        function setupEventListeners() {
            // Your existing event listeners...
            
            // Add forum event listeners
            setupForumEventListeners();
            
            // Tab functionality
            const featureTabs = document.querySelectorAll('.feature-tab');
            featureTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    featureTabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.feature-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId + '-content').classList.add('active');
                });
            });

            // Updated modal functionality with Firebase
            setupModals();

            // Updated navigation
            setupNavigation();

            // Age verification
            document.getElementById('age-verification').addEventListener('change', function() {
                document.getElementById('signupSubmitBtn').disabled = !this.checked;
            });

            // Page navigation
            setupPageNavigation();

            // AI Chat
            document.getElementById('send-message').addEventListener('click', sendMessage);

            // Volunteer form with Firebase
            document.getElementById('volunteerForm').addEventListener('submit', submitVolunteerForm);
        }

        // Updated modal functions with Firebase
        function setupModals() {
            const loginBtn = document.getElementById('loginBtn');
            const signupBtn = document.getElementById('signupBtn');
            const loginModal = document.getElementById('loginModal');
            const signupModal = document.getElementById('signupModal');
            const closeButtons = document.querySelectorAll('.close-modal');
            const switchToSignup = document.getElementById('switchToSignup');
            const switchToLogin = document.getElementById('switchToLogin');

            loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
            signupBtn.addEventListener('click', () => signupModal.style.display = 'flex');

            closeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    loginModal.style.display = 'none';
                    signupModal.style.display = 'none';
                });
            });

            switchToSignup.addEventListener('click', (e) => {
                e.preventDefault();
                loginModal.style.display = 'none';
                signupModal.style.display = 'flex';
            });

            switchToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                signupModal.style.display = 'none';
                loginModal.style.display = 'flex';
            });

            window.addEventListener('click', (e) => {
                if (e.target === loginModal) loginModal.style.display = 'none';
                if (e.target === signupModal) signupModal.style.display = 'none';
            });

            // Updated login form with Firebase
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginUsername').value; // Note: using username field for email
                const password = document.getElementById('loginPassword').value;
                
                const result = await Database.loginUser(email, password);
                if (result.success) {
                    showNotification('Login successful!', 'success');
                    loginModal.style.display = 'none';
                } else {
                    showNotification('Login failed: ' + result.error, 'error');
                }
            });

            // Updated signup form with Firebase
            document.getElementById('signupForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('signupUsername').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const age = document.getElementById('signupAge').value;
                
                if (age < 13) {
                    showNotification('You must be at least 13 years old to use YouthCare', 'error');
                    return;
                }
                
                if (!document.getElementById('age-verification').checked) {
                    showNotification('Please confirm you are at least 13 years old', 'error');
                    return;
                }
                
                const result = await Database.registerUser({
                    username,
                    email,
                    password,
                    age: parseInt(age)
                });
                
                if (result.success) {
                    showNotification('Account created successfully!', 'success');
                    signupModal.style.display = 'none';
                } else {
                    showNotification('Registration failed: ' + result.error, 'error');
                }
            });
        }

        // Updated volunteer form with Firebase
        async function submitVolunteerForm(e) {
            e.preventDefault();
            
            const applicationData = {
                name: document.getElementById('volunteer-name').value,
                email: document.getElementById('volunteer-email').value,
                age: parseInt(document.getElementById('volunteer-age').value),
                location: document.getElementById('volunteer-location').value,
                background: document.getElementById('volunteer-background').value,
                experience: document.getElementById('volunteer-experience').value,
                availability: document.getElementById('volunteer-availability').value,
                motivation: document.getElementById('volunteer-motivation').value
            };
            
            if (!applicationData.name || !applicationData.email || !applicationData.age) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            if (applicationData.age < 18) {
                showNotification('You must be at least 18 years old to volunteer', 'error');
                return;
            }
            
            const result = await Database.submitVolunteerApplication(applicationData);
            if (result.success) {
                showNotification('Thank you for your application! We will review it and contact you soon.', 'success');
                document.getElementById('volunteerForm').reset();
            } else {
                showNotification('Error submitting application: ' + result.error, 'error');
            }
        }

        function logout() {
            auth.signOut();
            showNotification('Logged out successfully', 'success');
        }

        // Your existing functions remain the same...
        function loadSampleData() {
            // ... your existing sample data loading
        }

        function initializeFeatures() {
            // ... your existing feature initialization
        }

        // Make functions globally available
        window.likePost = likePost;
        window.toggleComments = toggleComments;
        window.addComment = addComment;
        window.removeRitualStep = removeRitualStep;
        window.saveQuickJournal = saveQuickJournal;
    </script>
</body>
</html>
